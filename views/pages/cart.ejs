<%- include('../partials/layout_top') -%>

      <section id="cart">
        <% if (items.length > 0 ) { %>

          <% let totalPrice = 0  %> 

          <% items.forEach((item) => { %>
            <% totalPrice += item.product.price * item.quantity %>
          <% }) %>
          
          <div id="checkout">
            <h1>
              Your total is
              <span style="color: #008000"> $<%= totalPrice %>  </span>
            </h1>
          </div> 
      <section>
        <div class="container text-center">
          <div class="mb-3 row">
            <div class="col">
              <section>
         
                <!-- Show available products in cart -->
                <% items.forEach(item => { %>
                  <% const total = item.product.price * item.quantity %>
                   <div class="card" style="width: 18rem;">
                     <img src="/images/<%= item.product.image %>" loading="lazy" alt="" />
                     <div class="card-body">
                      <h3 class="product-name"><%= item.product.name %></h3>
                      <p class="product-price">Price: <span class="value">$<%= item.product.price %></span></p>
            
                      <form method="POST" action="/cart?_method=PUT">
                       <input class="form-control form-control-sm" type="number" name="quantity" value=<%= item.quantity %> min=<%= item.product.minimumOrder %> max=<%= item.product.countInStock %> />
         
                       <input class="form-control form-control-sm" type="hidden" name="product" value="<%= item.product._id %>" >
         
                       <button class="form-control form-control-sm" id="save" type="submit">Save change</button>
                     </form>
            
                      <p class="product-price">Total: <span class="value">$<%= total %></span></p>
 
                      <form method="POST" action="/cart?_method=DELETE">
                       <input class="form-control form-control-sm" type="hidden" name="product" value="<%= item.product._id %>" >
                       <input class="form-control form-control-sm" type="hidden" name="url" value="/cart" >
                       <button class="form-control form-control-sm" id="remove" type="submit">Remove from cart</button>
                     </form>
                     </div>
                     
                   </div>
                <% }) %> 
         
               </section>
         
            </div>
            <div class="col">
              <section id="place-order">
                <form method="POST" action="/payments">
                  <div>
                    <input class="form-control form-control-sm" type="hidden" name="totalPrice" value="<%= totalPrice %>">
                    <input class="form-control form-control-sm" type="hidden" name="items" value="<%= items %>">
                    <div class="form-group">
                      <input class="form-control form-control-sm" type="text" name="name" placeholder="Name" required />
                    </div>
      
                    <div class="form-group">
                      <input
                        class="form-control form-control-sm"
                        type="text"
                        name="street"
                        placeholder="Street + Number"
                        required
                      />
                    </div>
      
                    <div class="form-group">
                      <input class="form-control form-control-sm" type="text" name="zipcode" placeholder="Zip Code" required />
                    </div>
      
                    <div class="form-group">
                      <input class="form-control form-control-sm" type="text" name="city" placeholder="City" required />
                    </div>
      
                    <div class="form-group">
                      <input class="form-control form-control-sm" type="text" name="state" placeholder="State/Region" required />
                    </div>
      
                    <div class="form-group">
                      <input
                        class="form-control form-control-sm"
                        type="text"
                        name="additional"
                        placeholder="Additional information (optional)"
                      />
                    </div>
                  </div>
      
                  <div id="form-action">
                    <button type="submit">Checkout</button>
                    <!--<a href="/">Checkout</a>-->
                  </div>
                </form>
              </section>
            </div>
          </div>
        </div>
      </section>

        <% } else { %>
          <span>No items added to cart</span>
        <% } %> 

        <!-- Cart Items -->
      
      </section>

      
<%- include('../partials/layout_bottom') -%>
